<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞–≤–∏–≥–∞—Ç–æ—Ä –†–ñ–î–ö –£—Å—Å—É—Ä–∏–π—Å–∫</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=be0c8369-7476-47a3-a315-59ab429fadcb&lang=ru_RU"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: #1a1a1a;
            color: white;
            min-height: 100vh;
        }

        .map-container {
            width: 100%;
            height: 100vh;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        .building-sheet {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            background: #2c3e50;
            border-radius: 20px 20px 0 0;
            padding: 20px;
            transition: bottom 0.4s ease;
            z-index: 999;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 -5px 25px rgba(0,0,0,0.5);
        }

        .building-sheet.active {
            bottom: 0;
        }

        .sheet-handle {
            width: 50px;
            height: 4px;
            background: #7f8c8d;
            border-radius: 2px;
            margin: 0 auto 20px auto;
        }

        .buildings-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 998;
        }

        .building-btn {
            padding: 12px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.98);
            z-index: 1003;
            padding: 20px;
            overflow-y: auto;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-content {
            background: #2c3e50;
            padding: 20px;
            border-radius: 15px;
            max-width: 600px;
            margin: 20px auto;
        }

        .admin-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .btn {
            padding: 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px 0;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .btn-compile {
            background: #9b59b6;
            width: 100%;
            font-size: 16px;
            font-weight: bold;
            padding: 15px;
        }

        .pin-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #3498db;
            border-radius: 8px;
            background: #34495e;
            color: white;
        }

        .file-select {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #3498db;
            border-radius: 8px;
            background: #34495e;
            color: white;
        }

        @media (max-width: 768px) {
            .buildings-bar {
                bottom: 10px;
                flex-wrap: nowrap;
                overflow-x: auto;
                max-width: 90%;
                padding: 0 10px;
            }
            
            .building-btn {
                font-size: 14px;
                padding: 10px 16px;
            }
            
            .admin-content {
                margin: 10px auto;
                padding: 15px;
            }
        }

        .building-image {
            width: 100%;
            height: 200px;
            background: #34495e;
            border-radius: 10px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #bdc3c7;
            border: 2px dashed #7f8c8d;
            position: relative;
            overflow: hidden;
        }

        .tabs {
            display: flex;
            gap: 5px;
            margin-bottom: 15px;
        }

        .tab {
            flex: 1;
            padding: 10px;
            background: #34495e;
            border: none;
            border-radius: 8px;
            color: white;
            cursor: pointer;
        }

        .tab.active {
            background: #3498db;
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .group-item {
            background: rgba(255,255,255,0.05);
            padding: 15px;
            border-radius: 8px;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .group-item.favorite {
            background: rgba(255,193,7,0.2);
            border: 2px solid #ffc107;
        }

        .group-item:hover {
            background: rgba(255,255,255,0.1);
        }

        .group-header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 10px;
        }

        .floor-item {
            background: rgba(255,255,255,0.03);
            padding: 10px;
            border-radius: 6px;
            margin: 5px 0;
        }

        .coords-display {
            background: #34495e;
            padding: 10px;
            border-radius: 8px;
            margin: 10px 0;
            font-family: monospace;
            text-align: center;
        }

        .file-info {
            background: rgba(255,255,255,0.05);
            padding: 10px;
            border-radius: 6px;
            margin: 5px 0;
            font-size: 14px;
        }

        .schedule-scroll {
            overflow-x: auto;
            white-space: nowrap;
            padding: 10px 0;
        }

        .schedule-image {
            height: 300px;
            display: inline-block;
            margin-right: 10px;
            border-radius: 8px;
        }

        .favorite-star {
            color: #ffc107;
            font-size: 20px;
        }

        .compile-section {
            background: rgba(155, 89, 182, 0.2);
            border: 2px dashed #9b59b6;
        }
    </style>
</head>
<body>
    <div class="admin-panel active" id="adminPanel">
        <div class="admin-content">
            <h2 style="margin-bottom: 20px;">‚öôÔ∏è –û—Ñ–ª–∞–π–Ω-—Ä–µ–¥–∞–∫—Ç–æ—Ä –Ω–∞–≤–∏–≥–∞—Ç–æ—Ä–∞</h2>
            
            <div class="admin-section">
                <h3>üè´ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–¥–∞–Ω–∏—è–º–∏</h3>
                <select id="buildingSelect" class="pin-input" onchange="loadBuildingData()">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ</option>
                </select>
                
                <input type="text" id="buildingName" class="pin-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–¥–∞–Ω–∏—è">
                
                <div class="coords-display" id="coordsDisplay">
                    –ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: 43.790882, 131.944252
                </div>
                <button class="btn" onclick="startPlacemarkMode()">üìç –£—Å—Ç–∞–Ω–æ–≤–∏—Ç—å –º–µ—Ç–∫—É –Ω–∞ –∫–∞—Ä—Ç–µ</button>
                
                <button class="btn" onclick="saveBuilding()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–¥–∞–Ω–∏–µ</button>
                <button class="btn btn-success" onclick="addNewBuilding()">‚ûï –ù–æ–≤–æ–µ –∑–¥–∞–Ω–∏–µ</button>
                <button class="btn btn-danger" onclick="deleteBuilding()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∑–¥–∞–Ω–∏–µ</button>
            </div>

            <div class="admin-section" id="buildingDetails">
                <h3>üìã –î–µ—Ç–∞–ª–∏ –∑–¥–∞–Ω–∏—è: <span id="currentBuildingName">–ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å</span></h3>
                
                <div class="tabs">
                    <button class="tab active" onclick="switchTab('floors')">–≠—Ç–∞–∂–∏</button>
                    <button class="tab" onclick="switchTab('groups')">–ì—Ä—É–ø–ø—ã</button>
                </div>
                
                <div class="tab-content active" id="floorsTab">
                    <div id="floorsList">
                        <!-- –≠—Ç–∞–∂–∏ –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                    <button class="btn btn-success" onclick="addFloor()">‚ûï –î–æ–±–∞–≤–∏—Ç—å —ç—Ç–∞–∂</button>
                </div>
                
                <div class="tab-content" id="groupsTab">
                    <input type="text" id="newGroupName" class="pin-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã">
                    <button class="btn btn-success" onclick="addGroup()">‚ûï –î–æ–±–∞–≤–∏—Ç—å –≥—Ä—É–ø–ø—É</button>
                    
                    <div id="groupsList">
                        <!-- –ì—Ä—É–ø–ø—ã –±—É–¥—É—Ç –∑–¥–µ—Å—å -->
                    </div>
                </div>
            </div>

            <div class="admin-section compile-section">
                <h3>üîß –ö–æ–º–ø–∏–ª—è—Ü–∏—è</h3>
                <p style="margin-bottom: 15px; color: #bdc3c7;">
                    –ü–æ—Å–ª–µ –Ω–∞—Å—Ç—Ä–æ–π–∫–∏ –≤—Å–µ—Ö –∑–¥–∞–Ω–∏–π –Ω–∞–∂–º–∏—Ç–µ –∫–Ω–æ–ø–∫—É –Ω–∏–∂–µ —á—Ç–æ–±—ã —Å–æ–∑–¥–∞—Ç—å –≥–æ—Ç–æ–≤—ã–π —Ñ–∞–π–ª –¥–ª—è GitHub Pages
                </p>
                <button class="btn btn-compile" onclick="compileProject()">üöÄ –°–ö–û–ú–ü–ò–õ–ò–†–û–í–ê–¢–¨ –ü–†–û–ï–ö–¢</button>
            </div>

            <button class="btn btn-danger" onclick="hideAdminPanel()">üëÄ –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
        </div>
    </div>

    <div class="map-container" style="display: none;" id="previewContainer">
        <div id="map"></div>
    </div>

    <div class="buildings-bar" id="buildingsBar" style="display: none;">
        <!-- –ö–Ω–æ–ø–∫–∏ –∑–¥–∞–Ω–∏–π -->
    </div>

    <div class="building-sheet" id="buildingSheet">
        <div class="sheet-handle"></div>
        <h3 id="sheetBuildingName">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–¥–∞–Ω–∏—è</h3>
        
        <div class="tabs">
            <button class="tab active" onclick="switchUserTab('floors')">üè¢ –≠—Ç–∞–∂–∏</button>
            <button class="tab" onclick="switchUserTab('schedule')">üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
        </div>
        
        <div class="tab-content active" id="userFloorsTab">
            <div id="userFloorsList">
                <!-- –≠—Ç–∞–∂–∏ –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            </div>
        </div>
        
        <div class="tab-content" id="userScheduleTab">
            <div id="userGroupsList">
                <!-- –ì—Ä—É–ø–ø—ã –¥–ª—è –ø–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—è -->
            </div>
        </div>
        
        <button class="btn" onclick="closeBuildingSheet()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <script>
        // –°–ø–∏—Å–∫–∏ —Ñ–∞–π–ª–æ–≤ –∫–∞–∫ —Ç—ã —É–∫–∞–∑–∞–ª - –í–°–ï –ö–ê–†–¢–ò–ù–ö–ò –ë–£–î–£–¢ –í –ü–ê–ü–ö–ï files/
        const FLOOR_PLANS = ["1.jpg", "2.jpg", "3.jpg"];
        const ROOM_PLANS = [
            "111.jpg", "211.jpg", "212.jpg", "311.jpg", "312.jpg", "411.jpg", 
            "611.jpg", "811.jpg", "812.jpg", "911.jpg", "1011.jpg", "1111.jpg",
            "121.jpg", "321.jpg", "421.jpg", "621.jpg", "921.jpg", "1021.jpg", 
            "1121.jpg", "131.jpg", "231.jpg", "241.jpg", "741.jpg"
        ];

        let map;
        let buildings = [];
        let currentBuildingId = null;
        let placemarkMode = false;
        let tempPlacemark = null;
        let userFavorites = JSON.parse(localStorage.getItem('userFavorites')) || [];

        // –ó–∞–≥—Ä—É–∂–∞–µ–º –¥–∞–Ω–Ω—ã–µ
        function loadBuildings() {
            const saved = localStorage.getItem('rzhdk_buildings');
            if (saved) {
                buildings = JSON.parse(saved);
            } else {
                // –°–æ–∑–¥–∞–µ–º –Ω–∞—á–∞–ª—å–Ω–æ–µ –∑–¥–∞–Ω–∏–µ
                buildings = [{
                    id: 1,
                    name: '–ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å',
                    coords: [43.790882, 131.944252],
                    floors: [],
                    groups: []
                }];
                saveBuildings();
            }
            
            renderBuildings();
            renderBuildingButtons();
            updateBuildingSelect();
            loadBuildingData();
        }

        function saveBuildings() {
            localStorage.setItem('rzhdk_buildings', JSON.stringify(buildings));
        }

        function initMap() {
            map = new ymaps.Map('map', {
                center: [43.790882, 131.944252],
                zoom: 17,
                controls: ['zoomControl', 'fullscreenControl']
            });

            loadBuildings();
        }

        function renderBuildings() {
            if (!map) return;
            
            map.geoObjects.removeAll();
            
            buildings.forEach(building => {
                const placemark = new ymaps.Placemark(building.coords, {
                    balloonContent: `<strong>${building.name}</strong>`
                }, {
                    preset: 'islands#blueIcon'
                });
                
                placemark.events.add('click', () => {
                    showBuildingSheet(building);
                });
                
                map.geoObjects.add(placemark);
            });
        }

        function renderBuildingButtons() {
            const bar = document.getElementById('buildingsBar');
            bar.innerHTML = '';
            
            buildings.forEach(building => {
                const btn = document.createElement('button');
                btn.className = 'building-btn';
                btn.textContent = building.name;
                btn.onclick = () => {
                    map.setCenter(building.coords, 17);
                    showBuildingSheet(building);
                };
                bar.appendChild(btn);
            });
        }

        function updateBuildingSelect() {
            const select = document.getElementById('buildingSelect');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ</option>';
            
            buildings.forEach(building => {
                const option = document.createElement('option');
                option.value = building.id;
                option.textContent = building.name;
                select.appendChild(option);
            });
            
            if (buildings.length > 0) {
                select.value = buildings[0].id;
            }
        }

        function loadBuildingData() {
            const buildingId = parseInt(document.getElementById('buildingSelect').value);
            currentBuildingId = buildingId;
            
            if (!buildingId) {
                clearBuildingForm();
                return;
            }
            
            const building = buildings.find(b => b.id === buildingId);
            if (building) {
                document.getElementById('buildingName').value = building.name;
                document.getElementById('currentBuildingName').textContent = building.name;
                document.getElementById('coordsDisplay').textContent = `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${building.coords[0]}, ${building.coords[1]}`;
                
                renderFloors(building);
                renderGroups(building);
            }
        }

        function clearBuildingForm() {
            document.getElementById('buildingName').value = '';
            document.getElementById('currentBuildingName').textContent = '‚Äî';
            document.getElementById('coordsDisplay').textContent = '–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: –Ω–µ —É—Å—Ç–∞–Ω–æ–≤–ª–µ–Ω—ã';
            currentBuildingId = null;
        }

        function startPlacemarkMode() {
            if (!currentBuildingId) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –∑–¥–∞–Ω–∏–µ');
                return;
            }
            
            placemarkMode = true;
            
            if (tempPlacemark) {
                map.geoObjects.remove(tempPlacemark);
            }
            
            tempPlacemark = new ymaps.Placemark(map.getCenter(), {}, {
                preset: 'islands#redIcon',
                draggable: true
            });
            
            map.geoObjects.add(tempPlacemark);
            
            tempPlacemark.events.add('dragend', function() {
                const coords = tempPlacemark.geometry.getCoordinates();
                document.getElementById('coordsDisplay').textContent = `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${coords[0].toFixed(6)}, ${coords[1].toFixed(6)}`;
            });
            
            alert('üìç –ü–µ—Ä–µ–º–µ—Å—Ç–∏—Ç–µ –º–µ—Ç–∫—É –Ω–∞ –Ω—É–∂–Ω–æ–µ –º–µ—Å—Ç–æ –Ω–∞ –∫–∞—Ä—Ç–µ, –∑–∞—Ç–µ–º —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ –∑–¥–∞–Ω–∏–µ');
        }

        function addNewBuilding() {
            const newId = buildings.length > 0 ? Math.max(...buildings.map(b => b.id)) + 1 : 1;
            currentBuildingId = newId;
            
            const newBuilding = {
                id: newId,
                name: '–ù–æ–≤–æ–µ –∑–¥–∞–Ω–∏–µ',
                coords: map.getCenter(),
                floors: [],
                groups: []
            };
            buildings.push(newBuilding);
            
            document.getElementById('buildingName').value = newBuilding.name;
            document.getElementById('currentBuildingName').textContent = newBuilding.name;
            document.getElementById('coordsDisplay').textContent = `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${newBuilding.coords[0].toFixed(6)}, ${newBuilding.coords[1].toFixed(6)}`;
            
            updateBuildingSelect();
            document.getElementById('buildingSelect').value = newId;
            
            saveBuildings();
            renderBuildingButtons();
            
            alert('‚úÖ –ù–æ–≤–æ–µ –∑–¥–∞–Ω–∏–µ —Å–æ–∑–¥–∞–Ω–æ! –¢–µ–ø–µ—Ä—å —É—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –º–µ—Ç–∫—É –∏ —Å–æ—Ö—Ä–∞–Ω–∏—Ç–µ.');
        }

        function saveBuilding() {
            if (!currentBuildingId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –∑–¥–∞–Ω–∏–µ');
                return;
            }
            
            let building = buildings.find(b => b.id === currentBuildingId);
            let coords;
            
            if (tempPlacemark) {
                coords = tempPlacemark.geometry.getCoordinates();
                map.geoObjects.remove(tempPlacemark);
                tempPlacemark = null;
            } else if (building) {
                coords = building.coords;
            } else {
                coords = map.getCenter();
            }
            
            if (building) {
                building.name = document.getElementById('buildingName').value;
                building.coords = coords;
            }
            
            document.getElementById('coordsDisplay').textContent = `–ö–æ–æ—Ä–¥–∏–Ω–∞—Ç—ã: ${coords[0].toFixed(6)}, ${coords[1].toFixed(6)}`;
            
            saveBuildings();
            renderBuildings();
            renderBuildingButtons();
            updateBuildingSelect();
            
            alert('‚úÖ –ó–¥–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
            placemarkMode = false;
        }

        function deleteBuilding() {
            if (!currentBuildingId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∑–¥–∞–Ω–∏–µ "${document.getElementById('buildingName').value}"?`)) {
                return;
            }
            
            buildings = buildings.filter(b => b.id !== currentBuildingId);
            saveBuildings();
            renderBuildings();
            renderBuildingButtons();
            updateBuildingSelect();
            clearBuildingForm();
            
            alert('‚úÖ –ó–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!');
        }

        function addFloor() {
            if (!currentBuildingId) return;
            
            const building = buildings.find(b => b.id === currentBuildingId);
            const floorNumber = building.floors.length + 1;
            
            building.floors.push({
                number: floorNumber,
                name: `–≠—Ç–∞–∂ ${floorNumber}`,
                planFile: null,
                rooms: []
            });
            
            saveBuildings();
            renderFloors(building);
        }

        function renderFloors(building) {
            const floorsList = document.getElementById('floorsList');
            floorsList.innerHTML = '';
            
            building.floors.forEach((floor, index) => {
                const floorItem = document.createElement('div');
                floorItem.className = 'floor-item';
                
                const floorOptions = FLOOR_PLANS.map(file => 
                    `<option value="${file}" ${floor.planFile === file ? 'selected' : ''}>${file}</option>`
                ).join('');
                
                const roomOptions = ROOM_PLANS.map(file => 
                    `<option value="${file}">${file}</option>`
                ).join('');
                
                const roomsHTML = floor.rooms.map((room, roomIndex) => `
                    <div style="display: flex; gap: 10px; margin: 5px 0; align-items: center;">
                        <input type="text" value="${room.name}" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∫–∞–±–∏–Ω–µ—Ç–∞" 
                               onchange="updateRoomName(${index}, ${roomIndex}, this.value)" 
                               style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid #34495e; background: #2c3e50; color: white;">
                        <select onchange="updateRoomPlan(${index}, ${roomIndex}, this.value)" 
                                style="padding: 8px; border-radius: 4px; border: 1px solid #34495e; background: #2c3e50; color: white;">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞–Ω</option>
                            ${roomOptions}
                        </select>
                        <button onclick="deleteRoom(${index}, ${roomIndex})" style="background: #e74c3c; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer;">‚ùå</button>
                    </div>
                `).join('');
                
                floorItem.innerHTML = `
                    <strong>${floor.name}</strong>
                    <div style="margin-top: 10px;">
                        <input type="text" value="${floor.name}" onchange="updateFloorName(${index}, this.value)" 
                               class="pin-input" style="font-size: 12px; padding: 8px;">
                        
                        <select class="file-select" onchange="updateFloorPlan(${index}, this.value)">
                            <option value="">-- –í—ã–±–µ—Ä–∏—Ç–µ –ø–ª–∞–Ω —ç—Ç–∞–∂–∞ --</option>
                            ${floorOptions}
                        </select>
                        
                        ${floor.planFile ? `<div class="file-info">‚úÖ –í—ã–±—Ä–∞–Ω —Ñ–∞–π–ª: ${floor.planFile}</div>` : ''}
                        
                        <div style="margin: 15px 0;">
                            <strong>–ö–∞–±–∏–Ω–µ—Ç—ã –Ω–∞ —ç—Ç–∞–∂–µ:</strong>
                            ${roomsHTML}
                            <button class="btn" style="background: #f39c12; padding: 8px; margin-top: 10px;" 
                                    onclick="addRoom(${index})">‚ûï –î–æ–±–∞–≤–∏—Ç—å –∫–∞–±–∏–Ω–µ—Ç</button>
                        </div>
                        
                        <button class="btn" style="background: #e74c3c; padding: 8px; margin-top: 5px;" 
                                onclick="deleteFloor(${index})">‚ùå –£–¥–∞–ª–∏—Ç—å —ç—Ç–∞–∂</button>
                    </div>
                `;
                floorsList.appendChild(floorItem);
            });
        }

        function updateFloorName(floorIndex, newName) {
            if (!currentBuildingId) return;
            const building = buildings.find(b => b.id === currentBuildingId);
            building.floors[floorIndex].name = newName;
            saveBuildings();
        }

        function updateFloorPlan(floorIndex, fileName) {
            if (!currentBuildingId) return;
            const building = buildings.find(b => b.id === currentBuildingId);
            building.floors[floorIndex].planFile = fileName || null;
            saveBuildings();
            renderFloors(building);
        }

        function addRoom(floorIndex) {
            if (!currentBuildingId) return;
            const building = buildings.find(b => b.id === currentBuildingId);
            building.floors[floorIndex].rooms.push({
                name: '–ù–æ–≤—ã–π –∫–∞–±–∏–Ω–µ—Ç',
                planFile: null
            });
            saveBuildings();
            renderFloors(building);
        }

        function updateRoomName(floorIndex, roomIndex, newName) {
            if (!currentBuildingId) return;
            const building = buildings.find(b => b.id === currentBuildingId);
            building.floors[floorIndex].rooms[roomIndex].name = newName;
            saveBuildings();
        }

        function updateRoomPlan(floorIndex, roomIndex, fileName) {
            if (!currentBuildingId) return;
            const building = buildings.find(b => b.id === currentBuildingId);
            building.floors[floorIndex].rooms[roomIndex].planFile = fileName || null;
            saveBuildings();
        }

        function deleteRoom(floorIndex, roomIndex) {
            if (!currentBuildingId) return;
            const building = buildings.find(b => b.id === currentBuildingId);
            building.floors[floorIndex].rooms.splice(roomIndex, 1);
            saveBuildings();
            renderFloors(building);
        }

        function deleteFloor(floorIndex) {
            if (!currentBuildingId) return;
            const building = buildings.find(b => b.id === currentBuildingId);
            building.floors.splice(floorIndex, 1);
            saveBuildings();
            renderFloors(building);
        }

        function addGroup() {
            if (!currentBuildingId) return;
            
            const groupName = document.getElementById('newGroupName').value.trim();
            if (!groupName) {
                alert('–í–≤–µ–¥–∏—Ç–µ –Ω–∞–∑–≤–∞–Ω–∏–µ –≥—Ä—É–ø–ø—ã');
                return;
            }
            
            const building = buildings.find(b => b.id === currentBuildingId);
            
            building.groups.push({
                name: groupName,
                scheduleFiles: []
            });
            
            document.getElementById('newGroupName').value = '';
            saveBuildings();
            renderGroups(building);
        }

        function renderGroups(building) {
            const groupsList = document.getElementById('groupsList');
            groupsList.innerHTML = '';
            
            building.groups.forEach((group, index) => {
                const groupItem = document.createElement('div');
                groupItem.className = 'group-item';
                
                const scheduleOptions = ROOM_PLANS.map(file => 
                    `<option value="${file}">${file}</option>`
                ).join('');
                
                const schedulesHTML = group.scheduleFiles.map((file, fileIndex) => `
                    <div style="display: flex; gap: 10px; margin: 5px 0; align-items: center;">
                        <select onchange="updateGroupSchedule(${index}, ${fileIndex}, this.value)" 
                                style="flex: 1; padding: 8px; border-radius: 4px; border: 1px solid #34495e; background: #2c3e50; color: white;">
                            <option value="">–í—ã–±–µ—Ä–∏—Ç–µ —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</option>
                            ${scheduleOptions}
                        </select>
                        <button onclick="deleteGroupSchedule(${index}, ${fileIndex})" style="background: #e74c3c; color: white; border: none; padding: 8px; border-radius: 4px; cursor: pointer;">‚ùå</button>
                    </div>
                `).join('');
                
                groupItem.innerHTML = `
                    <div class="group-header">
                        <strong>${group.name}</strong>
                        <button class="btn" style="background: #e74c3c; padding: 5px 10px;" onclick="deleteGroup(${index})">‚ùå</button>
                    </div>
                    
                    <div style="margin: 10px 0;">
                        <strong>–†–∞—Å–ø–∏—Å–∞–Ω–∏—è –≥—Ä—É–ø–ø—ã:</strong>
                        ${schedulesHTML}
                        <button class="btn" style="background: #f39c12; padding: 8px; margin-top: 10px;" 
                                onclick="addGroupSchedule(${index})">‚ûï –î–æ–±–∞–≤–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ</button>
                    </div>
                `;
                groupsList.appendChild(groupItem);
            });
        }

        function addGroupSchedule(groupIndex) {
            if (!currentBuildingId) return;
            const building = buildings.find(b => b.id === currentBuildingId);
            building.groups[groupIndex].scheduleFiles.push('');
            saveBuildings();
            renderGroups(building);
        }

        function updateGroupSchedule(groupIndex, fileIndex, fileName) {
            if (!currentBuildingId) return;
            const building = buildings.find(b => b.id === currentBuildingId);
            building.groups[groupIndex].scheduleFiles[fileIndex] = fileName;
            saveBuildings();
        }

        function deleteGroupSchedule(groupIndex, fileIndex) {
            if (!currentBuildingId) return;
            const building = buildings.find(b => b.id === currentBuildingId);
            building.groups[groupIndex].scheduleFiles.splice(fileIndex, 1);
            saveBuildings();
            renderGroups(building);
        }

        function deleteGroup(groupIndex) {
            if (!currentBuildingId) return;
            const building = buildings.find(b => b.id === currentBuildingId);
            building.groups.splice(groupIndex, 1);
            saveBuildings();
            renderGroups(building);
        }

        function switchTab(tabName) {
            document.querySelectorAll('.tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('.tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById(tabName + 'Tab').classList.add('active');
        }

        function switchUserTab(tabName) {
            document.querySelectorAll('#buildingSheet .tab').forEach(tab => tab.classList.remove('active'));
            document.querySelectorAll('#buildingSheet .tab-content').forEach(content => content.classList.remove('active'));
            
            event.target.classList.add('active');
            document.getElementById('user' + tabName.charAt(0).toUpperCase() + tabName.slice(1) + 'Tab').classList.add('active');
        }

        function showBuildingSheet(building) {
            document.getElementById('sheetBuildingName').textContent = building.name;
            
            // –†–µ–Ω–¥–µ—Ä–∏–º —ç—Ç–∞–∂–∏
            const userFloorsList = document.getElementById('userFloorsList');
            userFloorsList.innerHTML = '';
            
            building.floors.forEach(floor => {
                const floorItem = document.createElement('div');
                floorItem.className = 'floor-item';
                floorItem.innerHTML = `
                    <strong>${floor.name}</strong>
                    ${floor.planFile ? `
                        <div class="building-image">
                            <img src="files/${floor.planFile}" style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;" onclick="toggleImageZoom(this)" alt="–ü–ª–∞–Ω ${floor.name}">
                            <div style="position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 5px; border-radius: 5px; font-size: 12px;">
                                üîç –ù–∞–∂–º–∏ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è
                            </div>
                        </div>
                    ` : '<p style="color: #bdc3c7; margin: 10px 0;">–ü–ª–∞–Ω –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω</p>'}
                    
                    ${floor.rooms.map(room => `
                        <div style="margin: 10px 0; padding: 10px; background: rgba(255,255,255,0.05); border-radius: 6px;">
                            <strong>${room.name}</strong>
                            ${room.planFile ? `
                                <div class="building-image">
                                    <img src="files/${room.planFile}" style="width: 100%; height: 150px; object-fit: contain; border-radius: 8px;" onclick="toggleImageZoom(this)" alt="–ü–ª–∞–Ω ${room.name}">
                                </div>
                            ` : ''}
                        </div>
                    `).join('')}
                `;
                userFloorsList.appendChild(floorItem);
            });
            
            // –†–µ–Ω–¥–µ—Ä–∏–º –≥—Ä—É–ø–ø—ã —Å –∏–∑–±—Ä–∞–Ω–Ω—ã–º–∏
            const userGroupsList = document.getElementById('userGroupsList');
            userGroupsList.innerHTML = '';
            
            // –°–Ω–∞—á–∞–ª–∞ –∏–∑–±—Ä–∞–Ω–Ω—ã–µ
            const favoriteGroups = building.groups.filter(group => 
                userFavorites.includes(group.name)
            );
            
            // –ü–æ—Ç–æ–º –æ—Å—Ç–∞–ª—å–Ω—ã–µ
            const otherGroups = building.groups.filter(group => 
                !userFavorites.includes(group.name)
            );
            
            const sortedGroups = [...favoriteGroups, ...otherGroups];
            
            sortedGroups.forEach(group => {
                const groupItem = document.createElement('div');
                groupItem.className = `group-item ${userFavorites.includes(group.name) ? 'favorite' : ''}`;
                
                groupItem.innerHTML = `
                    <div class="group-header">
                        <strong>${group.name}</strong>
                        ${userFavorites.includes(group.name) ? '<span class="favorite-star">‚≠ê</span>' : ''}
                    </div>
                    ${group.scheduleFiles.length > 0 ? `
                        <div class="schedule-scroll">
                            ${group.scheduleFiles.map(file => `
                                <img src="files/${file}" class="schedule-image" alt="–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ ${group.name}">
                            `).join('')}
                        </div>
                    ` : '<p style="color: #bdc3c7; margin: 10px 0;">–†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ</p>'}
                `;
                
                // –î–≤–æ–π–Ω–æ–π –∫–ª–∏–∫ –¥–ª—è –∏–∑–±—Ä–∞–Ω–Ω–æ–≥–æ
                groupItem.ondblclick = () => toggleFavorite(group.name);
                userGroupsList.appendChild(groupItem);
            });
            
            document.getElementById('buildingSheet').classList.add('active');
        }

        function toggleFavorite(groupName) {
            if (userFavorites.includes(groupName)) {
                userFavorites = userFavorites.filter(name => name !== groupName);
            } else {
                userFavorites.push(groupName);
            }
            localStorage.setItem('userFavorites', JSON.stringify(userFavorites));
            
            // –û–±–Ω–æ–≤–ª—è–µ–º –æ—Ç–æ–±—Ä–∞–∂–µ–Ω–∏–µ
            const currentBuilding = buildings.find(b => b.id === currentBuildingId);
            if (currentBuilding) {
                showBuildingSheet(currentBuilding);
            }
        }

        function toggleImageZoom(img) {
            if (img.style.transform === 'scale(1.5)') {
                img.style.transform = 'scale(1)';
                img.style.cursor = 'zoom-in';
            } else {
                img.style.transform = 'scale(1.5)';
                img.style.cursor = 'zoom-out';
            }
        }

        function closeBuildingSheet() {
            document.getElementById('buildingSheet').classList.remove('active');
        }

        function hideAdminPanel() {
            document.getElementById('adminPanel').style.display = 'none';
            document.getElementById('previewContainer').style.display = 'block';
            document.getElementById('buildingsBar').style.display = 'flex';
            renderBuildings();
        }

        function showAdminPanel() {
            document.getElementById('adminPanel').style.display = 'block';
            document.getElementById('previewContainer').style.display = 'none';
            document.getElementById('buildingsBar').style.display = 'none';
        }

        function compileProject() {
            const projectData = {
                buildings: buildings,
                files: {
                    floorPlans: FLOOR_PLANS,
                    roomPlans: ROOM_PLANS
                },
                compileDate: new Date().toISOString()
            };
            
            const dataStr = JSON.stringify(projectData, null, 2);
            const blob = new Blob([dataStr], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            
            const link = document.createElement('a');
            link.href = url;
            link.download = 'rzhdk_data.json';
            link.click();
            
            alert('‚úÖ –ü—Ä–æ–µ–∫—Ç —Å–∫–æ–º–ø–∏–ª–∏—Ä–æ–≤–∞–Ω! –§–∞–π–ª "rzhdk_data.json" —Å–∫–∞—á–∞–Ω.\n\n–¢–µ–ø–µ—Ä—å –∑–∞–≥—Ä—É–∑–∏—Ç–µ –µ–≥–æ –≤ –≤–∞—à —Ä–µ–ø–æ–∑–∏—Ç–æ—Ä–∏–π –Ω–∞ GitHub –≤–º–µ—Å—Ç–µ —Å –ø–∞–ø–∫–æ–π files/ –∏ –≤—Å–µ–º–∏ –∫–∞—Ä—Ç–∏–Ω–∫–∞–º–∏.');
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        ymaps.ready(initMap);
    </script>
</body>
</html>