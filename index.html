<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>–ù–∞–≤–∏–≥–∞—Ç–æ—Ä –†–ñ–î–ö –£—Å—Å—É—Ä–∏–π—Å–∫</title>
    <script src="https://api-maps.yandex.ru/2.1/?apikey=be0c8369-7476-47a3-a315-59ab429fadcb&lang=ru_RU"></script>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
            font-family: 'Segoe UI', Arial, sans-serif;
        }

        body {
            background: #1a1a1a;
            color: white;
            height: 100vh;
            overflow: hidden;
        }

        /* –ö–∞—Ä—Ç–∞ */
        .map-container {
            width: 100%;
            height: 100vh;
            position: relative;
        }

        #map {
            width: 100%;
            height: 100%;
        }

        /* –ù–∏–∂–Ω—è—è —à—Ç–æ—Ä–∫–∞ */
        .building-sheet {
            position: fixed;
            bottom: -100%;
            left: 0;
            right: 0;
            background: #2c3e50;
            border-radius: 20px 20px 0 0;
            padding: 20px;
            transition: bottom 0.4s ease;
            z-index: 999;
            max-height: 80vh;
            overflow-y: auto;
            box-shadow: 0 -5px 25px rgba(0,0,0,0.5);
        }

        .building-sheet.active {
            bottom: 0;
        }

        .sheet-handle {
            width: 50px;
            height: 4px;
            background: #7f8c8d;
            border-radius: 2px;
            margin: 0 auto 20px auto;
        }

        /* –ö–Ω–æ–ø–∫–∏ –∑–¥–∞–Ω–∏–π */
        .buildings-bar {
            position: fixed;
            bottom: 20px;
            left: 50%;
            transform: translateX(-50%);
            display: flex;
            gap: 10px;
            z-index: 998;
        }

        .building-btn {
            padding: 12px 20px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 25px;
            cursor: pointer;
            font-weight: 600;
            white-space: nowrap;
            box-shadow: 0 4px 15px rgba(52, 152, 219, 0.3);
        }

        /* –ê–¥–º–∏–Ω–∫–∞ */
        .admin-panel {
            display: none;
            position: fixed;
            top: 0;
            left: 0;
            right: 0;
            bottom: 0;
            background: rgba(0,0,0,0.98);
            z-index: 1003;
            padding: 20px;
            overflow-y: auto;
        }

        .admin-panel.active {
            display: block;
        }

        .admin-content {
            background: #2c3e50;
            padding: 20px;
            border-radius: 15px;
            max-width: 500px;
            margin: 20px auto;
        }

        .admin-section {
            margin: 20px 0;
            padding: 15px;
            background: rgba(255,255,255,0.1);
            border-radius: 10px;
        }

        .btn {
            width: 100%;
            padding: 12px;
            background: #3498db;
            color: white;
            border: none;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px 0;
        }

        .btn-success {
            background: #27ae60;
        }

        .btn-danger {
            background: #e74c3c;
        }

        .pin-input {
            width: 100%;
            padding: 12px;
            margin: 10px 0;
            border: 2px solid #3498db;
            border-radius: 8px;
            background: #34495e;
            color: white;
        }

        .file-upload {
            border: 2px dashed #7f8c8d;
            border-radius: 8px;
            padding: 20px;
            text-align: center;
            margin: 10px 0;
            cursor: pointer;
            transition: all 0.3s ease;
        }

        .file-upload:hover {
            border-color: #3498db;
            background: rgba(52, 152, 219, 0.1);
        }

        /* –ú–æ–±–∏–ª—å–Ω–∞—è –∞–¥–∞–ø—Ç–∞—Ü–∏—è */
        @media (max-width: 768px) {
            .buildings-bar {
                bottom: 10px;
                flex-wrap: nowrap;
                overflow-x: auto;
                max-width: 90%;
                padding: 0 10px;
            }
            
            .building-btn {
                font-size: 14px;
                padding: 10px 16px;
            }
            
            .admin-content {
                margin: 10px auto;
                padding: 15px;
            }
        }

        .building-image {
            width: 100%;
            height: 200px;
            background: #34495e;
            border-radius: 10px;
            margin: 15px 0;
            display: flex;
            align-items: center;
            justify-content: center;
            color: #bdc3c7;
            border: 2px dashed #7f8c8d;
            position: relative;
            overflow: hidden;
        }

        .admin-instruction {
            background: #34495e;
            padding: 15px;
            border-radius: 10px;
            margin: 10px 0;
            font-size: 14px;
        }

        .admin-instruction code {
            background: #2c3e50;
            padding: 2px 6px;
            border-radius: 4px;
            font-family: monospace;
            color: #3498db;
        }
    </style>
</head>
<body>
    <!-- –ê–¥–º–∏–Ω –ø–∞–Ω–µ–ª—å (–∏–∑–Ω–∞—á–∞–ª—å–Ω–æ —Å–∫—Ä—ã—Ç–∞) -->
    <div class="admin-panel" id="adminPanel">
        <div class="admin-content">
            <h2 style="margin-bottom: 20px; display: flex; align-items: center; gap: 10px;">
                ‚öôÔ∏è –°–∫—Ä—ã—Ç–∞—è –ø–∞–Ω–µ–ª—å —É–ø—Ä–∞–≤–ª–µ–Ω–∏—è
            </h2>
            
            <div class="admin-instruction">
                <strong>üîí –°–µ–∫—Ä–µ—Ç–Ω—ã–π –¥–æ—Å—Ç—É–ø:</strong><br>
                –î–æ–±–∞–≤—å –≤ URL: <code>?admin=secret</code>
            </div>
            
            <div class="admin-section">
                <h3>üè´ –£–ø—Ä–∞–≤–ª–µ–Ω–∏–µ –∑–¥–∞–Ω–∏—è–º–∏</h3>
                <select id="buildingSelect" class="pin-input" onchange="loadBuildingData()">
                    <option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ</option>
                </select>
                
                <input type="text" id="buildingName" class="pin-input" placeholder="–ù–∞–∑–≤–∞–Ω–∏–µ –∑–¥–∞–Ω–∏—è">
                <input type="text" id="buildingAddress" class="pin-input" placeholder="–ê–¥—Ä–µ—Å">
                <input type="text" id="buildingPhone" class="pin-input" placeholder="–¢–µ–ª–µ—Ñ–æ–Ω">
                
                <button class="btn" onclick="saveBuilding()">üíæ –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–¥–∞–Ω–∏–µ</button>
                <button class="btn btn-success" onclick="addNewBuilding()">‚ûï –ù–æ–≤–æ–µ –∑–¥–∞–Ω–∏–µ</button>
                <button class="btn btn-danger" onclick="deleteBuilding()">üóëÔ∏è –£–¥–∞–ª–∏—Ç—å –∑–¥–∞–Ω–∏–µ</button>
            </div>

            <div class="admin-section">
                <h3>üìÅ –ó–∞–≥—Ä—É–∑–∫–∞ —Ñ–∞–π–ª–æ–≤</h3>
                
                <div style="margin-bottom: 15px; padding: 10px; background: rgba(255,255,255,0.1); border-radius: 8px;">
                    <strong>–¢–µ–∫—É—â–µ–µ –∑–¥–∞–Ω–∏–µ:</strong>
                    <span id="currentBuildingName" style="color: #3498db;">‚Äî</span>
                </div>
                
                <div class="file-upload" onclick="document.getElementById('planUpload').click()">
                    üó∫Ô∏è –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–Ω –∫–∞–±–∏–Ω–µ—Ç–æ–≤
                    <br>
                    <small>JPG, PNG (–º–∞–∫—Å. 5MB)</small>
                </div>
                <input type="file" id="planUpload" style="display: none;" accept="image/*" onchange="uploadPlan(this.files[0])">
                
                <div style="margin: 10px 0;">
                    <button class="btn" style="background: #e74c3c; padding: 8px;" onclick="clearPlan()">
                        ‚ùå –£–¥–∞–ª–∏—Ç—å –ø–ª–∞–Ω
                    </button>
                </div>
                
                <div class="file-upload" onclick="document.getElementById('scheduleUpload').click()">
                    üìÖ –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                    <br>
                    <small>JPG, PNG (–º–∞–∫—Å. 5MB)</small>
                </div>
                <input type="file" id="scheduleUpload" style="display: none;" accept="image/*" onchange="uploadSchedule(this.files[0])">
                
                <div style="margin: 10px 0;">
                    <button class="btn" style="background: #e74c3c; padding: 8px;" onclick="clearSchedule()">
                        ‚ùå –£–¥–∞–ª–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
                    </button>
                </div>
            </div>

            <div class="admin-section">
                <h3>üíæ –†–µ–∑–µ—Ä–≤–Ω–∞—è –∫–æ–ø–∏—è</h3>
                <button class="btn btn-success" onclick="exportData()">üì• –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                <button class="btn" onclick="importData()">üì§ –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö</button>
                <input type="file" id="importFile" style="display: none;" accept=".json" onchange="handleImport(this.files[0])">
                <button class="btn btn-danger" onclick="resetData()">üîÑ –°–±—Ä–æ—Å–∏—Ç—å –≤—Å–µ –¥–∞–Ω–Ω—ã–µ</button>
            </div>

            <button class="btn btn-danger" onclick="hideAdminPanel()">‚ùå –ó–∞–∫—Ä—ã—Ç—å –∞–¥–º–∏–Ω–∫—É</button>
        </div>
    </div>

    <!-- –ö–æ–Ω—Ç–µ–π–Ω–µ—Ä –∫–∞—Ä—Ç—ã -->
    <div class="map-container">
        <div id="map"></div>
    </div>

    <!-- –ü–∞–Ω–µ–ª—å –∫–Ω–æ–ø–æ–∫ –∑–¥–∞–Ω–∏–π -->
    <div class="buildings-bar" id="buildingsBar">
        <!-- –ö–Ω–æ–ø–∫–∏ –±—É–¥—É—Ç –¥–æ–±–∞–≤–ª—è—Ç—å—Å—è —á–µ—Ä–µ–∑ JS -->
    </div>

    <!-- –®—Ç–æ—Ä–∫–∞ —Å –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏–µ–π –æ –∑–¥–∞–Ω–∏–∏ -->
    <div class="building-sheet" id="buildingSheet">
        <div class="sheet-handle"></div>
        <h3 id="sheetBuildingName">–ù–∞–∑–≤–∞–Ω–∏–µ –∑–¥–∞–Ω–∏—è</h3>
        <p id="sheetBuildingAddress" style="color: #bdc3c7; margin: 10px 0;"></p>
        <p id="sheetBuildingPhone" style="color: #bdc3c7; margin: 10px 0;"></p>
        
        <div class="building-image" id="sheetBuildingPlan">
            üó∫Ô∏è –ü–ª–∞–Ω –∫–∞–±–∏–Ω–µ—Ç–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω
        </div>
        
        <div class="building-image" id="sheetBuildingSchedule">
            üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ
        </div>
        
        <button class="btn" onclick="closeBuildingSheet()">–ó–∞–∫—Ä—ã—Ç—å</button>
    </div>

    <script>
        // –°–µ–∫—Ä–µ—Ç–Ω—ã–π –∫–ª—é—á –¥–ª—è –¥–æ—Å—Ç—É–ø–∞ –∫ –∞–¥–º–∏–Ω–∫–µ
        const ADMIN_SECRET = "secret";
        let map;
        let buildings = [];
        let currentBuildingId = null;
        let isAdminMode = false;

        // –î–∞–Ω–Ω—ã–µ –∑–¥–∞–Ω–∏–π –ø–æ —É–º–æ–ª—á–∞–Ω–∏—é
        const defaultBuildings = [
            {
                id: 1,
                name: '–ì–ª–∞–≤–Ω—ã–π –∫–æ—Ä–ø—É—Å',
                address: '—É–ª. –ì–æ—Ä—å–∫–æ–≥–æ, 15',
                phone: '+7 (4234) 12-34-56',
                coords: [43.790882, 131.944252],
                schedule: null,
                plan: null
            },
            {
                id: 2, 
                name: '–û–±—â–µ–∂–∏—Ç–∏–µ ‚Ññ1',
                address: '—É–ª. –õ–µ–Ω–∏–Ω–∞, 42',
                phone: '+7 (4234) 12-34-57',
                coords: [43.791500, 131.945000],
                schedule: null,
                plan: null
            },
            {
                id: 3,
                name: '–°–ø–æ—Ä—Ç–∏–≤–Ω—ã–π –∫–æ–º–ø–ª–µ–∫—Å',
                address: '—É–ª. –°–ø–æ—Ä—Ç–∏–≤–Ω–∞—è, 5',
                phone: '+7 (4234) 12-34-58',
                coords: [43.789800, 131.943500],
                schedule: null,
                plan: null
            }
        ];

        // –ü—Ä–æ–≤–µ—Ä–∫–∞ —Å–µ–∫—Ä–µ—Ç–Ω–æ–≥–æ –¥–æ—Å—Ç—É–ø–∞ –∏–∑ URL
        function checkAdminAccess() {
            const urlParams = new URLSearchParams(window.location.search);
            const adminParam = urlParams.get('admin');
            
            if (adminParam === ADMIN_SECRET) {
                isAdminMode = true;
                showAdminPanel();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –∫–∞—Ä—Ç—ã
        function initMap() {
            map = new ymaps.Map('map', {
                center: [43.790882, 131.944252],
                zoom: 17,
                controls: ['zoomControl', 'fullscreenControl']
            });

            loadBuildings();
            checkAdminAccess(); // –ü—Ä–æ–≤–µ—Ä—è–µ–º –¥–æ—Å—Ç—É–ø –ø—Ä–∏ –∑–∞–≥—Ä—É–∑–∫–µ
        }

        // –ó–∞–≥—Ä—É–∑–∫–∞ –∑–¥–∞–Ω–∏–π
        function loadBuildings() {
            const saved = localStorage.getItem('rzhdk_buildings');
            buildings = saved ? JSON.parse(saved) : defaultBuildings;
            
            renderBuildings();
            renderBuildingButtons();
            updateBuildingSelect();
        }

        // –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ –∑–¥–∞–Ω–∏–π
        function saveBuildings() {
            localStorage.setItem('rzhdk_buildings', JSON.stringify(buildings));
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∑–¥–∞–Ω–∏–π –Ω–∞ –∫–∞—Ä—Ç–µ
        function renderBuildings() {
            map.geoObjects.removeAll();
            
            buildings.forEach(building => {
                const placemark = new ymaps.Placemark(building.coords, {
                    balloonContent: `
                        <strong>${building.name}</strong><br>
                        ${building.address}<br>
                        üìû ${building.phone}
                    `
                }, {
                    preset: 'islands#blueIcon'
                });
                
                placemark.events.add('click', () => {
                    showBuildingSheet(building);
                });
                
                map.geoObjects.add(placemark);
            });
        }

        // –û—Ç—Ä–∏—Å–æ–≤–∫–∞ –∫–Ω–æ–ø–æ–∫ –∑–¥–∞–Ω–∏–π
        function renderBuildingButtons() {
            const bar = document.getElementById('buildingsBar');
            bar.innerHTML = '';
            
            buildings.forEach(building => {
                const btn = document.createElement('button');
                btn.className = 'building-btn';
                btn.textContent = building.name;
                btn.onclick = () => {
                    map.setCenter(building.coords, 17);
                    showBuildingSheet(building);
                };
                bar.appendChild(btn);
            });
        }

        // –û–±–Ω–æ–≤–∏—Ç—å —Å–µ–ª–µ–∫—Ç–æ—Ä –≤ –∞–¥–º–∏–Ω–∫–µ
        function updateBuildingSelect() {
            const select = document.getElementById('buildingSelect');
            select.innerHTML = '<option value="">–í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ</option>';
            
            buildings.forEach(building => {
                const option = document.createElement('option');
                option.value = building.id;
                option.textContent = building.name;
                select.appendChild(option);
            });
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –¥–∞–Ω–Ω—ã–µ –∑–¥–∞–Ω–∏—è –≤ –∞–¥–º–∏–Ω–∫—É
        function loadBuildingData() {
            const buildingId = parseInt(document.getElementById('buildingSelect').value);
            currentBuildingId = buildingId;
            
            if (!buildingId) {
                clearBuildingForm();
                return;
            }
            
            const building = buildings.find(b => b.id === buildingId);
            if (building) {
                document.getElementById('buildingName').value = building.name;
                document.getElementById('buildingAddress').value = building.address;
                document.getElementById('buildingPhone').value = building.phone;
                document.getElementById('currentBuildingName').textContent = building.name;
            }
        }

        // –û—á–∏—Å—Ç–∏—Ç—å —Ñ–æ—Ä–º—É –∑–¥–∞–Ω–∏—è
        function clearBuildingForm() {
            document.getElementById('buildingName').value = '';
            document.getElementById('buildingAddress').value = '';
            document.getElementById('buildingPhone').value = '';
            document.getElementById('currentBuildingName').textContent = '‚Äî';
            currentBuildingId = null;
        }

        // –î–æ–±–∞–≤–∏—Ç—å –Ω–æ–≤–æ–µ –∑–¥–∞–Ω–∏–µ
        function addNewBuilding() {
            const newId = buildings.length > 0 ? Math.max(...buildings.map(b => b.id)) + 1 : 1;
            currentBuildingId = newId;
            
            clearBuildingForm();
            document.getElementById('buildingName').value = '–ù–æ–≤–æ–µ –∑–¥–∞–Ω–∏–µ';
            document.getElementById('currentBuildingName').textContent = '–ù–æ–≤–æ–µ –∑–¥–∞–Ω–∏–µ';
            
            setTimeout(() => {
                document.getElementById('buildingSelect').value = newId;
            }, 100);
        }

        // –°–æ—Ö—Ä–∞–Ω–∏—Ç—å –∑–¥–∞–Ω–∏–µ
        function saveBuilding() {
            if (!currentBuildingId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –∏–ª–∏ —Å–æ–∑–¥–∞–π—Ç–µ –∑–¥–∞–Ω–∏–µ');
                return;
            }
            
            let building = buildings.find(b => b.id === currentBuildingId);
            
            if (!building) {
                building = {
                    id: currentBuildingId,
                    name: document.getElementById('buildingName').value,
                    address: document.getElementById('buildingAddress').value,
                    phone: document.getElementById('buildingPhone').value,
                    coords: [43.790882, 131.944252],
                    schedule: null,
                    plan: null
                };
                buildings.push(building);
            } else {
                building.name = document.getElementById('buildingName').value;
                building.address = document.getElementById('buildingAddress').value;
                building.phone = document.getElementById('buildingPhone').value;
            }
            
            saveBuildings();
            renderBuildings();
            renderBuildingButtons();
            updateBuildingSelect();
            
            alert('‚úÖ –ó–¥–∞–Ω–∏–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω–æ!');
        }

        // –£–¥–∞–ª–∏—Ç—å –∑–¥–∞–Ω–∏–µ
        function deleteBuilding() {
            if (!currentBuildingId) {
                alert('–í—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ –¥–ª—è —É–¥–∞–ª–µ–Ω–∏—è');
                return;
            }
            
            if (!confirm(`–£–¥–∞–ª–∏—Ç—å –∑–¥–∞–Ω–∏–µ "${document.getElementById('buildingName').value}"?`)) {
                return;
            }
            
            buildings = buildings.filter(b => b.id !== currentBuildingId);
            saveBuildings();
            renderBuildings();
            renderBuildingButtons();
            updateBuildingSelect();
            clearBuildingForm();
            
            alert('‚úÖ –ó–¥–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!');
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å –ø–ª–∞–Ω
        function uploadPlan(file) {
            if (!currentBuildingId) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ');
                return;
            }
            
            if (file && file.size > 5 * 1024 * 1024) {
                alert('‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 5MB');
                return;
            }
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const building = buildings.find(b => b.id === currentBuildingId);
                    if (building) {
                        building.plan = e.target.result;
                        saveBuildings();
                        alert('‚úÖ –ü–ª–∞–Ω –∫–∞–±–∏–Ω–µ—Ç–æ–≤ –∑–∞–≥—Ä—É–∂–µ–Ω!');
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // –ó–∞–≥—Ä—É–∑–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
        function uploadSchedule(file) {
            if (!currentBuildingId) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ');
                return;
            }
            
            if (file && file.size > 5 * 1024 * 1024) {
                alert('‚ùå –§–∞–π–ª —Å–ª–∏—à–∫–æ–º –±–æ–ª—å—à–æ–π! –ú–∞–∫—Å–∏–º—É–º 5MB');
                return;
            }
            
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    const building = buildings.find(b => b.id === currentBuildingId);
                    if (building) {
                        building.schedule = e.target.result;
                        saveBuildings();
                        alert('‚úÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ!');
                    }
                };
                reader.readAsDataURL(file);
            }
        }

        // –û—á–∏—Å—Ç–∏—Ç—å –ø–ª–∞–Ω
        function clearPlan() {
            if (!currentBuildingId) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ');
                return;
            }
            
            const building = buildings.find(b => b.id === currentBuildingId);
            if (building) {
                building.plan = null;
                saveBuildings();
                alert('‚úÖ –ü–ª–∞–Ω –∫–∞–±–∏–Ω–µ—Ç–æ–≤ —É–¥–∞–ª—ë–Ω!');
            }
        }

        // –û—á–∏—Å—Ç–∏—Ç—å —Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ
        function clearSchedule() {
            if (!currentBuildingId) {
                alert('–°–Ω–∞—á–∞–ª–∞ –≤—ã–±–µ—Ä–∏—Ç–µ –∑–¥–∞–Ω–∏–µ');
                return;
            }
            
            const building = buildings.find(b => b.id === currentBuildingId);
            if (building) {
                building.schedule = null;
                saveBuildings();
                alert('‚úÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ —É–¥–∞–ª–µ–Ω–æ!');
            }
        }

        // –≠–∫—Å–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function exportData() {
            const data = {
                buildings: buildings,
                exportDate: new Date().toISOString()
            };
            
            const blob = new Blob([JSON.stringify(data, null, 2)], { type: 'application/json' });
            const url = URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = `rzhdk_backup_${new Date().toISOString().split('T')[0]}.json`;
            a.click();
            URL.revokeObjectURL(url);
            
            alert('‚úÖ –î–∞–Ω–Ω—ã–µ —ç–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
        }

        // –ò–º–ø–æ—Ä—Ç –¥–∞–Ω–Ω—ã—Ö
        function importData() {
            document.getElementById('importFile').click();
        }

        function handleImport(file) {
            if (file) {
                const reader = new FileReader();
                reader.onload = function(e) {
                    try {
                        const data = JSON.parse(e.target.result);
                        if (data.buildings) {
                            if (confirm('–ó–∞–º–µ–Ω–∏—Ç—å —Ç–µ–∫—É—â–∏–µ –¥–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω–Ω—ã–º–∏?')) {
                                buildings = data.buildings;
                                saveBuildings();
                                loadBuildings();
                                alert('‚úÖ –î–∞–Ω–Ω—ã–µ –∏–º–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞–Ω—ã!');
                            }
                        } else {
                            alert('‚ùå –ù–µ–≤–µ—Ä–Ω—ã–π —Ñ–æ—Ä–º–∞—Ç —Ñ–∞–π–ª–∞!');
                        }
                    } catch (error) {
                        alert('‚ùå –û—à–∏–±–∫–∞ —á—Ç–µ–Ω–∏—è —Ñ–∞–π–ª–∞!');
                    }
                };
                reader.readAsText(file);
            }
        }

        // –°–±—Ä–æ—Å –¥–∞–Ω–Ω—ã—Ö
        function resetData() {
            if (confirm('‚ùå –í–ù–ò–ú–ê–ù–ò–ï! –≠—Ç–æ —É–¥–∞–ª–∏—Ç –≤—Å–µ –∑–¥–∞–Ω–∏—è –∏ –∑–∞–≥—Ä—É–∂–µ–Ω–Ω—ã–µ —Ñ–∞–π–ª—ã. –ü—Ä–æ–¥–æ–ª–∂–∏—Ç—å?')) {
                localStorage.removeItem('rzhdk_buildings');
                loadBuildings();
                alert('‚úÖ –í—Å–µ –¥–∞–Ω–Ω—ã–µ —Å–±—Ä–æ—à–µ–Ω—ã!');
            }
        }

        // –ü–æ–∫–∞–∑–∞—Ç—å —à—Ç–æ—Ä–∫—É —Å –¥–µ—Ç–∞–ª—è–º–∏ –∑–¥–∞–Ω–∏—è
        function showBuildingSheet(building) {
            document.getElementById('sheetBuildingName').textContent = building.name;
            document.getElementById('sheetBuildingAddress').textContent = building.address;
            document.getElementById('sheetBuildingPhone').textContent = `üìû ${building.phone}`;
            
            // –ü–ª–∞–Ω –∫–∞–±–∏–Ω–µ—Ç–æ–≤
            const planElement = document.getElementById('sheetBuildingPlan');
            if (building.plan) {
                planElement.innerHTML = `
                    <img src="${building.plan}" 
                         style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;" 
                         onclick="toggleImageZoom(this)">
                    <div style="position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 5px; border-radius: 5px; font-size: 12px;">
                        üîç –ù–∞–∂–º–∏ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è
                    </div>
                `;
            } else {
                planElement.innerHTML = 'üó∫Ô∏è –ü–ª–∞–Ω –∫–∞–±–∏–Ω–µ—Ç–æ–≤ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω';
            }
            
            // –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ
            const scheduleElement = document.getElementById('sheetBuildingSchedule');
            if (building.schedule) {
                scheduleElement.innerHTML = `
                    <img src="${building.schedule}" 
                         style="width: 100%; height: 100%; object-fit: contain; border-radius: 8px;" 
                         onclick="toggleImageZoom(this)">
                    <div style="position: absolute; bottom: 10px; right: 10px; background: rgba(0,0,0,0.7); padding: 5px; border-radius: 5px; font-size: 12px;">
                        üîç –ù–∞–∂–º–∏ –¥–ª—è —É–≤–µ–ª–∏—á–µ–Ω–∏—è
                    </div>
                `;
            } else {
                scheduleElement.innerHTML = 'üìÖ –†–∞—Å–ø–∏—Å–∞–Ω–∏–µ –Ω–µ –∑–∞–≥—Ä—É–∂–µ–Ω–æ';
            }
            
            document.getElementById('buildingSheet').classList.add('active');
        }

        // –£–≤–µ–ª–∏—á–µ–Ω–∏–µ –∏–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è
        function toggleImageZoom(img) {
            if (img.style.transform === 'scale(1.5)') {
                img.style.transform = 'scale(1)';
                img.style.cursor = 'zoom-in';
            } else {
                img.style.transform = 'scale(1.5)';
                img.style.cursor = 'zoom-out';
            }
        }

        // –ó–∞–∫—Ä—ã—Ç—å —à—Ç–æ—Ä–∫—É –∑–¥–∞–Ω–∏—è
        function closeBuildingSheet() {
            document.getElementById('buildingSheet').classList.remove('active');
        }

        // –ê–¥–º–∏–Ω–∫–∞
        function showAdminPanel() {
            document.getElementById('adminPanel').classList.add('active');
        }

        function hideAdminPanel() {
            document.getElementById('adminPanel').classList.remove('active');
            // –£–±–∏—Ä–∞–µ–º –ø–∞—Ä–∞–º–µ—Ç—Ä –∏–∑ URL –∫–æ–≥–¥–∞ –∑–∞–∫—Ä—ã–≤–∞–µ–º –∞–¥–º–∏–Ω–∫—É
            const url = new URL(window.location);
            url.searchParams.delete('admin');
            window.history.replaceState({}, '', url);
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        ymaps.ready(initMap);
    </script>
</body>
</html>